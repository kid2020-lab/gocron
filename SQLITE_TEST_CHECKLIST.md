# SQLite 功能测试清单

## 测试前准备

1. 确保已运行 `go mod tidy`
2. 编译项目：`make` 或 `go build`
3. 清理旧的配置文件（如果存在）：`rm -rf ~/.gocron/`

## 测试场景

### 场景 1：通过 Web 界面安装（SQLite）

**步骤：**
1. 启动服务：`./gocron web`
2. 访问：`http://localhost:5920/install`
3. 选择数据库类型：**SQLite**
4. 验证表单变化：
   - ✅ 主机名、端口、用户名、密码字段应该被隐藏
   - ✅ "数据库名称"标签应变为"数据库文件路径"
   - ✅ 默认路径应为 `./data/gocron.db`
5. 填写管理员信息：
   - 账号：admin
   - 邮箱：admin@example.com
   - 密码：123456
6. 点击"安装"
7. 验证结果：
   - ✅ 安装成功，跳转到登录页面
   - ✅ 数据库文件已创建：`./data/gocron.db`
   - ✅ 配置文件已创建：`~/.gocron/conf/app.ini`

### 场景 2：验证 SQLite 配置文件

**步骤：**
1. 查看配置文件：`cat ~/.gocron/conf/app.ini`
2. 验证内容：
   ```ini
   db.engine=sqlite
   db.database=./data/gocron.db
   db.host=
   db.port=0
   db.user=
   db.password=
   ```

### 场景 3：登录和基本功能测试

**步骤：**
1. 使用管理员账号登录
2. 创建一个测试任务：
   - 任务名称：测试任务
   - 任务类型：Shell
   - 命令：`echo "Hello SQLite"`
   - Cron 表达式：`*/5 * * * * *`（每5秒执行一次）
3. 启动任务
4. 查看任务日志
5. 验证结果：
   - ✅ 任务创建成功
   - ✅ 任务执行成功
   - ✅ 日志记录正常

### 场景 4：使用绝对路径

**步骤：**
1. 清理环境：`rm -rf ~/.gocron/ ./data/`
2. 重新安装，使用绝对路径：`/tmp/gocron-test.db`
3. 验证数据库文件创建在正确位置

### 场景 5：并发测试

**步骤：**
1. 创建多个任务（5-10个）
2. 同时启动所有任务
3. 观察执行情况
4. 验证结果：
   - ✅ 任务按顺序执行（SQLite 连接池限制为1）
   - ✅ 没有数据库锁定错误

### 场景 6：数据库切换测试

**步骤：**
1. 从 SQLite 切换到 MySQL：
   - 修改 `~/.gocron/conf/app.ini`
   - 重启服务
2. 从 MySQL 切换回 SQLite：
   - 修改配置
   - 重启服务
3. 验证结果：
   - ✅ 切换成功，服务正常启动

## 已知限制

1. **并发写入**：SQLite 连接池限制为 1，不适合高并发场景
2. **多实例**：不支持多个 gocron 实例共享同一个 SQLite 数据库
3. **性能**：大规模任务调度建议使用 MySQL 或 PostgreSQL

## 问题排查

### 问题 1：数据库文件创建失败
- 检查目录权限
- 检查磁盘空间
- 查看日志：`./log/cron.log`

### 问题 2：database is locked 错误
- 确认只有一个 gocron 实例在运行
- 检查连接池配置（应为 MaxOpenConns=1）

### 问题 3：表单验证失败
- 确认前端代码已更新
- 清除浏览器缓存
- 检查浏览器控制台错误

## 测试结果记录

| 测试场景 | 状态 | 备注 |
|---------|------|------|
| 场景 1：Web 安装 | ⬜ 未测试 | |
| 场景 2：配置文件 | ⬜ 未测试 | |
| 场景 3：基本功能 | ⬜ 未测试 | |
| 场景 4：绝对路径 | ⬜ 未测试 | |
| 场景 5：并发测试 | ⬜ 未测试 | |
| 场景 6：数据库切换 | ⬜ 未测试 | |

---

**测试完成后，请更新此文档并提交测试报告。**
